doctype html
html
	head
		title Late Night Snack
		style.
			/* Always set the map height explicitly to define the size of the div
			* element that contains the map. */
			#map {
			height: 100%;
			}
			/* Optional: Makes the sample page fill the window. */
			html, body {
			height: 100%;
			margin: 0;
			padding: 0;
			}
	body
		h3 Find your Midnight Snack
		br
		#map
		script.
			function initMap() {

				function escapeHtml(text) {
				  return text
					  .replace(/&amp;/g, "&")
					  .replace(/&lt;/g, "<")
					  .replace(/&gt;/g, ">")
					  .replace(/&quot;/g, '"')
					  .replace(/&#039;/g, "'");
				}

				function replaceLinkQuotes(text) { //replaces <a href="bla"> to <a href='bla'>
					return text
						.replace(/<a href="/g, "<a href='")
						.replace(/">/g, "'>");
				}

				var results = "#{JSON.stringify(allresults)}";
				results = escapeHtml(results);
				results = replaceLinkQuotes(results);
				results = JSON.parse(results);

				var centerlat = 52.370216;
				var centerlng = 4.895168;				
				var centerlocation = {lat: centerlat, lng: centerlng};

				var map = new google.maps.Map(document.getElementById('map'), {
						zoom: 15,
						center: centerlocation
				});

				function createMarker(){

					for(var i=0; i<results.length; i++){

						var resultlat = results[i].geometry.location.lat;
						var resultlng = results[i].geometry.location.lng;
						var resultlocation = {lat: resultlat, lng: resultlng};
						var resultname = results[i].name;
						var resultaddress = results[i].vicinity;
						var resultrating = results[i].rating;

						//Setting a new marker
						var marker = new google.maps.Marker({
							position: resultlocation,
							map: map,
							name: resultname,
							address: resultaddress,
							rating: resultrating
						});
						//Creating info windows
						var infowindow = new google.maps.InfoWindow();

						marker.addListener('click', function() {
							infowindow.setContent("<h1>"+this.name+"</h1>"+"<h2>"+this.address+"<br>"+"Rating: "+this.rating+"</h2>");
							infowindow.open(map, this);
						});
					}
				}
				createMarker();
			}
		script(src='https://maps.googleapis.com/maps/api/js?'+mapsjsapikey+'&callback=initMap', async='', defer='')
