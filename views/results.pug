doctype html
html
	head
		title Late Night Snack
		script(async='', defer='', src='https://maps.googleapis.com/maps/api/js?'+mapsjsapikey+'&libraries=places&callback=initMap')
			script.
				function initMap() {

					//CREATING MAP
					var centerlat = 52.370216;
					var centerlng = 4.895168;				
					var centerlocation = {lat: centerlat, lng: centerlng};

					var map = new google.maps.Map(document.getElementById('map'), {
					center: centerlocation,
					zoom: 15
					});

					//CLEANING OUT RESULTS FORMAT TO BE USED FOR SETTING MARKERS & DETAIL REQUEST
					function escapeHtml(text) {
						return text
						.replace(/&amp;/g, "&")
						.replace(/&lt;/g, "<")
						.replace(/&gt;/g, ">")
						.replace(/&quot;/g, '"')
						.replace(/&#039;/g, "'");
						}

					function replaceLinkQuotes(text) { //replaces <a href="bla"> to <a href='bla'>
						return text
							.replace(/<a href="/g, "<a href='")
							.replace(/">/g, "'>");
					}

					var results = "#{JSON.stringify(allresults)}";
					results = escapeHtml(results);
					results = replaceLinkQuotes(results);
					results = JSON.parse(results);
					console.log('Results frontend: '+results);

					//CREATING MARKERS
					function createMarker () {
						for (var i=0; i<results.length; i++){

							var resultlat = results[i].geometry.location.lat;
							var resultlng = results[i].geometry.location.lng;
							var resultlocation = {lat: resultlat, lng: resultlng};

							var marker = new google.maps.Marker({
								map: map,
								position: resultlocation
							});
						}
					}
					createMarker()
				}
					//- //CREATING INFO WINDOW & INITIALISING DETAIL SEARCH
					//- var infowindow = new google.maps.InfoWindow();
					//- var service = new google.maps.places.PlacesService(map);

					//- service.getDetails({
					//- 	placeId: 'ChIJN1t_tDeuEmsRUsoyG83frY4'
					//- }, function(place, status) {
					//- if (status === google.maps.places.PlacesServiceStatus.OK) {
					//- 	var marker = new google.maps.Marker({
					//- 		map: map,
					//- 		position: place.geometry.location
					//- 	});
					//- 	google.maps.event.addListener(marker, 'click', function() {
					//- 	infowindow.setContent('<div><strong>' + place.name + '</strong><br>' +
					//- 		'Place ID: ' + place.place_id + '<br>' +
					//- 		place.formatted_address + '</div>');
					//- 	infowindow.open(map, this);
					//- 	});
					//- }
					//- });
	body
		h3 Find your Midnight Snack
		br
		style.
			#map {
			position: absolute;
			top: 0;
			left: 0;
			width: 100% !important;
			height: 100% !important;
			}
			html, body {
			height: 100%;
			margin: 0;
			padding: 0;
			}
	body
		.container
		h1 Responsive Map
		#map_container
		#map